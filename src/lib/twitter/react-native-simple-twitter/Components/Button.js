import React from 'react';
import { TouchableOpacity, TouchableHighlight, TouchableWithoutFeedback, Modal, WebView, } from 'react-native';
import SafeAreaView from 'react-native-safe-area-view';
import Header from './Header';
import twitter from '../client';
class TWLoginButton extends React.Component {
    constructor(props) {
        super(props);
        this.onNavigationStateChange = async (webViewState) => {
            const match = webViewState.url.match(/\?oauth_token=.+&oauth_verifier=(.+)/);
            if (match && match.length > 0) {
                this.setState({
                    isVisible: false,
                });
                try {
                    const response = await twitter.getAccessToken(match[1]);
                    if (response.errors) {
                        throw new Error(JSON.stringify(response.errors));
                    }
                    this.token = response;
                }
                catch (err) {
                    console.warn(`[getAccessToken failed] ${err}`);
                    this.props.onError(err);
                }
                await this.props.onGetAccessToken(this.token);
                try {
                    const response = await twitter.get('account/verify_credentials.json', { include_entities: false, skip_status: true, include_email: true });
                    if (response.errors) {
                        throw new Error(JSON.stringify(response.errors));
                    }
                    this.user = response;
                }
                catch (err) {
                    console.warn(`[get("account/verify_credentials.json") failed] ${err}`);
                    this.props.onError(err);
                    return false;
                }
                await this.props.onSuccess(this.user);
                return true;
            }
            return false;
        };
        this.onButtonPress = async (e) => {
            await this.props.onPress(e);
            this.setState({
                isVisible: true,
                authURL: await twitter.getLoginUrl(this.props.callbackUrl),
            });
        };
        this.onClose = (e) => {
            this.setState({
                isVisible: false,
            }, () => this.props.onClose(e));
        };
        this.renderHeader = (props) => {
            if (this.props.renderHeader) {
                return React.cloneElement(this.props.renderHeader(props), props);
            }
            return <Header {...props}/>;
        };
        this.state = {
            isVisible: false,
            authURL: '',
        };
        this.token = '';
        this.user = null;
    }
    render() {
        let Component;
        switch (this.props.type) {
            case 'TouchableOpacity':
                Component = TouchableOpacity;
                break;
            case 'TouchableHighlight':
                Component = TouchableHighlight;
                break;
            case 'TouchableWithoutFeedback':
                Component = TouchableWithoutFeedback;
                break;
            default:
                console.warn('TWLoginButton type must be TouchableOpacity or TouchableHighlight or TouchableWithoutFeedback');
                return null;
        }
        return (<Component {...this.props} onPress={this.onButtonPress}>
        {this.props.children}
        <Modal visible={this.state.isVisible} animationType="slide" onRequestClose={() => { }}>
          <SafeAreaView style={{ flex: 1, backgroundColor: this.props.headerColor }}>
            {this.renderHeader({ headerColor: this.props.headerColor, onClose: this.onClose })}
            <WebView source={{ uri: this.state.authURL }} onNavigationStateChange={this.onNavigationStateChange}/>
          </SafeAreaView>
        </Modal>
      </Component>);
    }
}
TWLoginButton.defaultProps = {
    type: 'TouchableOpacity',
    headerColor: '#f7f7f7',
    callbackUrl: null,
    onPress: () => { },
    onGetAccessToken: () => { },
    onClose: () => { },
    onError: () => { },
    renderHeader: (props = {}) => <Header {...props}/>,
};
export default TWLoginButton;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQnV0dG9uLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL0NvbXBvbmVudHMvQnV0dG9uLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEtBQUssTUFBTSxPQUFPLENBQUM7QUFDMUIsT0FBTyxFQUNMLGdCQUFnQixFQUNoQixrQkFBa0IsRUFDbEIsd0JBQXdCLEVBQ3hCLEtBQUssRUFDTCxPQUFPLEdBQ1IsTUFBTSxjQUFjLENBQUM7QUFHdEIsT0FBTyxZQUFZLE1BQU0sNkJBQTZCLENBQUM7QUFHdkQsT0FBTyxNQUFNLE1BQU0sVUFBVSxDQUFDO0FBRzlCLE9BQU8sT0FBTyxNQUFNLFdBQVcsQ0FBQztBQW1CaEMsTUFBTSxhQUFjLFNBQVEsS0FBSyxDQUFDLFNBQXVCO0lBWXZELFlBQVksS0FBVTtRQUNwQixLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFXZiw0QkFBdUIsR0FBRyxLQUFLLEVBQUUsWUFBaUIsRUFBRSxFQUFFO1lBQ3BELE1BQU0sS0FBSyxHQUFHLFlBQVksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7WUFFN0UsSUFBSSxLQUFLLElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQzdCLElBQUksQ0FBQyxRQUFRLENBQUM7b0JBQ1osU0FBUyxFQUFFLEtBQUs7aUJBQ2pCLENBQUMsQ0FBQztnQkFHSCxJQUFJO29CQUNGLE1BQU0sUUFBUSxHQUFHLE1BQU0sT0FBTyxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFFeEQsSUFBSSxRQUFRLENBQUMsTUFBTSxFQUFFO3dCQUNuQixNQUFNLElBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7cUJBQ2xEO29CQUVELElBQUksQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDO2lCQUN2QjtnQkFBQyxPQUFP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LFNBQVM7SUFDdEIsV0FBVyxFQUFFLElBQUk7SUFDakIsT0FBTyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUM7SUFDbEIsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztJQUMzQixPQUFPLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztJQUNsQixPQUFPLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQztJQUNsQixZQUFZLEVBQUUsQ0FBQyxLQUFLLEdBQUcsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxFQUFHO0NBQ3BELENBQUE7QUE4SEgsZUFBZSxhQUFhLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgVG91Y2hhYmxlT3BhY2l0eSxcbiAgVG91Y2hhYmxlSGlnaGxpZ2h0LFxuICBUb3VjaGFibGVXaXRob3V0RmVlZGJhY2ssXG4gIE1vZGFsLFxuICBXZWJWaWV3LFxufSBmcm9tICdyZWFjdC1uYXRpdmUnO1xuXG4vKiBucG0gKi9cbmltcG9ydCBTYWZlQXJlYVZpZXcgZnJvbSAncmVhY3QtbmF0aXZlLXNhZmUtYXJlYS12aWV3JztcblxuLyogY29tcG9uZW50cyAqL1xuaW1wb3J0IEhlYWRlciBmcm9tICcuL0hlYWRlcic7XG5cbi8qIGNsaWVudCAqL1xuaW1wb3J0IHR3aXR0ZXIgZnJvbSAnLi4vY2xpZW50JztcblxuaW50ZXJmYWNlIFByb3BzIHtcbiAgdHlwZTogc3RyaW5nLFxuICBoZWFkZXJDb2xvcjogc3RyaW5nLFxuICBjYWxsYmFja1VybDogc3RyaW5nLFxuICBvblByZXNzKGU6IGFueSk6IHZvaWQsXG4gIG9uR2V0QWNjZXNzVG9rZW4odG9rZW46IHN0cmluZyk6IHZvaWQsXG4gIG9uQ2xvc2UoZTogYW55KTogdm9pZCxcbiAgb25TdWNjZXNzKHVzZXI6IGFueSk6IHZvaWQsXG4gIG9uRXJyb3IoZXJyOiBhbnkpOiB2b2lkLFxuICByZW5kZXJIZWFkZXIocHJvcHM6IGFueSk6IFJlYWN0LlJlYWN0RWxlbWVudDx7fT4sXG59XG5cbmludGVyZmFjZSBTdGF0ZSB7XG4gIGlzVmlzaWJsZTogYm9vbGVhbixcbiAgYXV0aFVSTDogc3RyaW5nLFxufVxuXG5jbGFzcyBUV0xvZ2luQnV0dG9uIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFByb3BzLCBTdGF0ZT4ge1xuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIHR5cGU6ICdUb3VjaGFibGVPcGFjaXR5JyxcbiAgICBoZWFkZXJDb2xvcjogJyNmN2Y3ZjcnLFxuICAgIGNhbGxiYWNrVXJsOiBudWxsLFxuICAgIG9uUHJlc3M6ICgpID0+IHsgfSxcbiAgICBvbkdldEFjY2Vzc1Rva2VuOiAoKSA9PiB7IH0sXG4gICAgb25DbG9zZTogKCkgPT4geyB9LFxuICAgIG9uRXJyb3I6ICgpID0+IHsgfSxcbiAgICByZW5kZXJIZWFkZXI6IChwcm9wcyA9IHt9KSA9PiA8SGVhZGVyIHsuLi5wcm9wc30gLz4sXG4gIH1cblxuICBjb25zdHJ1Y3Rvcihwcm9wczogYW55KSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGlzVmlzaWJsZTogZmFsc2UsXG4gICAgICBhdXRoVVJMOiAnJyxcbiAgICB9O1xuXG4gICAgdGhpcy50b2tlbiA9ICcnO1xuICAgIHRoaXMudXNlciA9IG51bGw7XG4gIH1cblxuICBvbk5hdmlnYXRpb25TdGF0ZUNoYW5nZSA9IGFzeW5jICh3ZWJWaWV3U3RhdGU6IGFueSkgPT4ge1xuICAgIGNvbnN0IG1hdGNoID0gd2ViVmlld1N0YXRlLnVybC5tYXRjaCgvXFw/b2F1dGhfdG9rZW49Lismb2F1dGhfdmVyaWZpZXI9KC4rKS8pO1xuXG4gICAgaWYgKG1hdGNoICYmIG1hdGNoLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBpc1Zpc2libGU6IGZhbHNlLFxuICAgICAgfSk7XG5cbiAgICAgIC8qIGdldCBhY2Nlc3MgdG9rZW4gKi9cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdHdpdHRlci5nZXRBY2Nlc3NUb2tlbihtYXRjaFsxXSk7XG5cbiAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9ycykge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihKU09OLnN0cmluZ2lmeShyZXNwb25zZS5lcnJvcnMpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudG9rZW4gPSByZXNwb25zZTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLndhcm4oYFtnZXRBY2Nlc3NUb2tlbiBmYWlsZWRdICR7ZXJyfWApO1xuICAgICAgICB0aGlzLnByb3BzLm9uRXJyb3IoZXJyKTtcbiAgICAgIH1cblxuICAgICAgYXdhaXQgdGhpcy5wcm9wcy5vbkdldEFjY2Vzc1Rva2VuKHRoaXMudG9rZW4pO1xuXG4gICAgICAvKiBnZXQgYWNjb3VudCAqL1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0d2l0dGVyLmdldCgnYWNjb3VudC92ZXJpZnlfY3JlZGVudGlhbHMuanNvbicsIHsgaW5jbHVkZV9lbnRpdGllczogZmFsc2UsIHNraXBfc3RhdHVzOiB0cnVlLCBpbmNsdWRlX2VtYWlsOiB0cnVlIH0pO1xuXG4gICAgICAgIGlmIChyZXNwb25zZS5lcnJvcnMpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UuZXJyb3JzKSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnVzZXIgPSByZXNwb25zZTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBjb25zb2xlLndhcm4oYFtnZXQoXCJhY2NvdW50L3ZlcmlmeV9jcmVkZW50aWFscy5qc29uXCIpIGZhaWxlZF0gJHtlcnJ9YCk7XG4gICAgICAgIHRoaXMucHJvcHMub25FcnJvcihlcnIpO1xuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgYXdhaXQgdGhpcy5wcm9wcy5vblN1Y2Nlc3ModGhpcy51c2VyKTtcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgb25CdXR0b25QcmVzcyA9IGFzeW5jIChlOiBhbnkpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICBhd2FpdCB0aGlzLnByb3BzLm9uUHJlc3MoZSk7XG5cbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGlzVmlzaWJsZTogdHJ1ZSxcbiAgICAgIGF1dGhVUkw6IGF3YWl0IHR3aXR0ZXIuZ2V0TG9naW5VcmwodGhpcy5wcm9wcy5jYWxsYmFja1VybCksXG4gICAgfSk7XG4gIH1cblxuICBvbkNsb3NlID0gKGU6IGFueSkgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgaXNWaXNpYmxlOiBmYWxzZSxcbiAgICB9LCAoKSA9PiB0aGlzLnByb3BzLm9uQ2xvc2UoZSkpO1xuICB9XG5cbiAgdG9rZW4hOiBhbnlcblxuICB1c2VyITogYW55XG5cbiAgcmVuZGVySGVhZGVyID0gKHByb3BzOiBhbnkpID0+IHtcbiAgICBpZiAodGhpcy5wcm9wcy5yZW5kZXJIZWFkZXIpIHtcbiAgICAgIHJldHVybiBSZWFjdC5jbG9uZUVsZW1lbnQodGhpcy5wcm9wcy5yZW5kZXJIZWFkZXIocHJvcHMpLCBwcm9wcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIDxIZWFkZXIgey4uLnByb3BzfSAvPjtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBsZXQgQ29tcG9uZW50O1xuXG4gICAgc3dpdGNoICh0aGlzLnByb3BzLnR5cGUpIHtcbiAgICAgIGNhc2UgJ1RvdWNoYWJsZU9wYWNpdHknOlxuICAgICAgICBDb21wb25lbnQgPSBUb3VjaGFibGVPcGFjaXR5O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ1RvdWNoYWJsZUhpZ2hsaWdodCc6XG4gICAgICAgIENvbXBvbmVudCA9IFRvdWNoYWJsZUhpZ2hsaWdodDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdUb3VjaGFibGVXaXRob3V0RmVlZGJhY2snOlxuICAgICAgICBDb21wb25lbnQgPSBUb3VjaGFibGVXaXRob3V0RmVlZGJhY2s7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgY29uc29sZS53YXJuKCdUV0xvZ2luQnV0dG9uIHR5cGUgbXVzdCBiZSBUb3VjaGFibGVPcGFjaXR5IG9yIFRvdWNoYWJsZUhpZ2hsaWdodCBvciBUb3VjaGFibGVXaXRob3V0RmVlZGJhY2snKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxDb21wb25lbnQgey4uLnRoaXMucHJvcHN9IG9uUHJlc3M9e3RoaXMub25CdXR0b25QcmVzc30+XG4gICAgICAgIHt0aGlzLnByb3BzLmNoaWxkcmVufVxuICAgICAgICA8TW9kYWxcbiAgICAgICAgICB2aXNpYmxlPXt0aGlzLnN0YXRlLmlzVmlzaWJsZX1cbiAgICAgICAgICBhbmltYXRpb25UeXBlPVwic2xpZGVcIlxuICAgICAgICAgIG9uUmVxdWVzdENsb3NlPXsoKSA9PiB7IH1cbiAgICAgICAgICB9XG4gICAgICAgID5cbiAgICAgICAgICA8U2FmZUFyZWFWaWV3IHN0eWxlPXt7IGZsZXg6IDEsIGJhY2tncm91bmRDb2xvcjogdGhpcy5wcm9wcy5oZWFkZXJDb2xvciB9fT5cbiAgICAgICAgICAgIHt0aGlzLnJlbmRlckhlYWRlcih7IGhlYWRlckNvbG9yOiB0aGlzLnByb3BzLmhlYWRlckNvbG9yLCBvbkNsb3NlOiB0aGlzLm9uQ2xvc2UgfSl9XG4gICAgICAgICAgICA8V2ViVmlldyBzb3VyY2U9e3sgdXJpOiB0aGlzLnN0YXRlLmF1dGhVUkwgfX0gb25OYXZpZ2F0aW9uU3RhdGVDaGFuZ2U9e3RoaXMub25OYXZpZ2F0aW9uU3RhdGVDaGFuZ2V9IC8+XG4gICAgICAgICAgPC9TYWZlQXJlYVZpZXc+XG4gICAgICAgIDwvTW9kYWw+XG4gICAgICA8L0NvbXBvbmVudD5cbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFRXTG9naW5CdXR0b247XG4iXX0=